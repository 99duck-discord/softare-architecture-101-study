# 7장 아키텍처 특성 범위

## 🔎 Survey and Question - 훑어보고 질문하기

### 소제목 훑어보기

1. 커플링과 커네이선스
2. 아키텍처 퀀텀과 세분도
   1. 사례 연구: GGG

### 사전 질문 / 내용에 대한 예언

#### 커플링과 커네이선스

Q. 커네이선스 개념에 다시 복습해보자.

- 배경: 구심/원심 커플링 개념은 아키텍처 분석에 활용하기에 너무 코드 레벨의 개념. 그렇기 때문에 밀러 페이지-존스는 새로운 커플링 메트릭으로 커네이선스를 소개함
- 정의: "두 컴포넌트 중 한쪽이 변경될 경우 다른 쪽도 변경해야 전체 시스템의 정합성이 맞는다면 이들은 커네이선스를 같고 있는 것이다."

- 정적 커네이선스: 정적 코드 분석으로 발견 가능한 커네이선스. 복수의 클라이언트 코드에서 특정한 클래스를 공유하는 경우, 각 클라이언트 코드는 서로에 대해 정적 커네이선스를 지님. 즉, 공유 클래스를 변경하면 두 클라이언트 코드 모두 변경 필요!

- 동적 커네이선스: 런타임 동작과 관련된 커네이선스로 동기 & 비동기로 다시 분류됨.

#### 아키텍처 퀀텀과 세분도

Q. 아키텍처 퀀텀(architecture quantum)이란 무엇인가?

- 정의: 아키텍처 퀀텀이란 높은 기능 응집도(high functional cohesion)와 동기적 커네이선스(synchronous connascence)를 지닌, 독립적으로 배포 가능한(independently deployable) 아티팩트

  - ex) 마이크로서비스 아키텍처에서 도메인 단위로 구분된 개별 마이크로서비스 하나하나가 퀀텀 하나
  - `독립적으로 배포 가능`: 독립적으로 동작하기에 필요한 모든 컴포넌트들까지 포함한 단위. WAS만이 아니라 연동되어야 하는 DB까지 포함하여 하나의 퀀텀.
  - `높은 기능 응집도` : 개별 아키텍트 퀀텀은 특정한 목적에 맞는 무언가를 수행
  - `동기적 커네이선스` : 아키텍처 퀀텀 내부에서는 서로를 동기적으로 호출. 요청을 보내고 응답을 받을 때까지 대기하는 구조.

- 현대 아키텍트들은 시스템 레벨보다는 퀀텀 레벨에서 아키텍처 특성을 정의.

---

## 📝 Read & Recite - 읽어보고 노트하기

[개인 정리 자료](https://github.com/bugoverdose/book-notes/blob/master/%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98_101/README.md)의 7장 관련 마크다운 확인

- 비동기 호출

  - 분산 서비스끼리 **동기 호출**을 하는 경우, 호출부(caller)는 피호출부(callee)의 응답을 기다려야 함.
  - **이벤트 기반 아키텍처의 비동기 호출**은 피호출부의 응답을 기다리지 않아도 되는 `fire-and-forget` 방식. 그러므로 운영 아키텍처에서 두 서비스는 개별적으로 작동시킬 수 있음.

- 메시지 큐 기반 비동기 통신 예시: Payment와 Auction 서비스로 구성된 마이크로서비스 아키텍처

  - Auction 서비스에서 경매가 끝나면 Payment 서비스로 결제 정보 전달.
  - **엄청나게 많은 경매가 일시 종료되는 경우**, 아키텍처가 제대로 설계되지 않았다면 첫번째 호출만 성공하고, 나머지는 전부 타임아웃이 뜰 것!
  - 해결 방안: Payment와 Auction 간에 비동기 통신 링크를 만들고 **메시지 큐가 일시적인 버퍼 역할을 수행**하도록 설계하면 비동기적 커네이선스 덕분에 아키텍처가 한층 더 유연해짐!

- DDD의 경계 컨텍스트

  - 도메인에 관한 모든 것이 내부에서는 보이지만, 외부의 다른 경계 컨텍스트에서는 보이지 않음.
  - DDD란 복잡한 문제 도메인을 체계적으로 분해하는 모델링 기법.
  - 각 문제 도메인에 자체 클래스를 두고 차이점은 그것을 통합하는 지점에서 조정하는 것이 경계 컨텍스트!
  - 비교) 사내 공통 엔티티를 개발자들이 자유롭게 재사용하는 경우, 커플링이 심해지고 복잡도 증가. => BAD.

- **도메인인가? 아키텍처 특성인가?**

  - 판단 기준: 구현을 위해 도메인 지식이 필요한가, 아니면 추상적인 아키텍처 특성인가?
  - 요구사항이 주어졌을 때 비즈니스 분석가에게 정확한 의미를 물어보고 있다면 도메인.
  - 탄력성과 같은 아키텍처 특성을 논할 때 구체적인 애플리케이션의 구체적인 기능/종류는 중요하지 않으며, 추상화하여 다룰 수 있음.

---

## 😎 Review - 요약하기

아키텍처 퀀텀이란 독립적으로 배포될 수 있으며 컴포넌트들이 서로 동기적으로 통신하고 높은 응집도를 지닌 단위라고 볼 수 있다.

- 마이크로서비스 아키텍처의 개별 마이크로서비스가 이 퀀텀에 해당된다고 볼 수 있다.

아키텍트는 아키텍처를 분석함에 있어 시스템 전체를 분석하는 것이 아니라 아키텍처 퀀텀들로 분리하고, 개별 퀀텀에 집중하여 아키텍처 특성을 분석할 수 있다.
